From 11be56e959ed73a3a6214fb2bae453c105df3b88 Mon Sep 17 00:00:00 2001
From: Roy Li <rongqing.li@windriver.com>
Date: Tue, 29 Jan 2019 15:23:38 +0800
Subject: [PATCH] portmap: allow portmap to manage portmap_t type socket

Upstream-Status: Pending

portmap needs to create socket to receive message

Signed-off-by: Roy Li <rongqing.li@windriver.com>
Signed-off-by: Yi Zhao <yi.zhao@windriver.com>
---
 policy/modules/services/portmap.te | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/policy/modules/services/portmap.te b/policy/modules/services/portmap.te
index 4620bb8..641bc63 100644
--- a/policy/modules/services/portmap.te
+++ b/policy/modules/services/portmap.te
@@ -33,7 +33,8 @@ files_pid_file(portmap_var_run_t)
 allow portmap_t self:capability { setgid setuid };
 dontaudit portmap_t self:capability sys_tty_config;
 allow portmap_t self:unix_stream_socket { accept listen };
-allow portmap_t self:tcp_socket { accept listen };
+allow portmap_t self:tcp_socket { create_socket_perms accept listen };
+allow portmap_t self:udp_socket create_socket_perms;
 
 manage_dirs_pattern(portmap_t, portmap_tmp_t, portmap_tmp_t)
 manage_files_pattern(portmap_t, portmap_tmp_t, portmap_tmp_t)
-- 
2.7.4

