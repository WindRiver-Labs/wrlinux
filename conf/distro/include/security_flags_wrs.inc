include conf/distro/include/security_flags.inc

# To override for multilib, use SECURITY_CFLAGS_pn-<pkg>_pn-<mlib>-<pkg>.
# If just SECURITY_CFLAGS_pn-<pkg> is defined, it will be used for all
# multilib variants, too.
#

# These really should be in security_flags.inc
SECURITY_NO_FORTIFY_CFLAGS ?= "-fstack-protector-all -pie -fpie"
SECURITY_NO_STACK_CFLAGS ?= "-pie -fpie ${lcl_maybe_fortify}"

# Deal with ppc specific linker failures when using the cflags
SECURITY_CFLAGS_pn-gcc-cross_powerpc = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-gcc_powerpc = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-glibc-initial_powerpc = ""
SECURITY_CFLAGS_pn-glibc_powerpc = ""
SECURITY_CFLAGS_pn-libmatchbox_powerpc = "${SECURITY_NO_STACK_CFLAGS}"
SECURITY_CFLAGS_pn-systemd_powerpc = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-wireshark_powerpc = ""
SECURITY_CFLAGS_pn-rpm_powerpc64 = ""

SECURITY_CFLAGS_pn-aspell = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-atkmm = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-autofs = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-beecrypt = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-btrfs-tools = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-busybox = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-c-ares = "${SECURITY_NO_FORTIFY_CFLAGS}"
SECURITY_CFLAGS_pn-cairomm = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-ceph = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-collectd = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-corosync = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-criu = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-cups = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-curlpp = ""
SECURITY_CFLAGS_pn-curl = "${SECURITY_NO_FORTIFY_CFLAGS}"
SECURITY_CFLAGS_pn-dconf = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-db = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-device-mapper-multipath = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-dialog-static = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-directfb = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-e2fsprogs = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-efitools = " "
SECURITY_CFLAGS_pn-efivar = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-enchant = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-evince = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-ghostscript = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-gperftools = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-expect = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-fcgi = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-flac = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-gdb = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-gmp = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-gnutls = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-glibmm = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-grep_mips64 = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-grub-efi = " "
SECURITY_CFLAGS_pn-gst-plugins-bad = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-gst-plugins-gl = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-gstreamer1.0-plugins-bad = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-gstreamer1.0-plugins-good = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-gtkmm = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-gzip = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-harfbuzz = "${SECURITY_NO_PIE_CFLAGS}"
#SECURITY_CFLAGS_pn-iasl = "${SECURITY_NO_FORTIFY_CFLAGS} ${@base_conditional('DEBUG_BUILD','1','','-D_FORTIFY_SOURCE=2',d)}"
SECURITY_CFLAGS_pn-imagemagick = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-insserv = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-iptables = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-ippool = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-kexec-tools = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-kexec-tools_mips64 = "-fstack-protector-all"
SECURITY_CFLAGS_pn-krb5 = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-leveldb = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-lftp = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-libcap = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-libconfig = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-libexec = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-libglu = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_append_pn-libhugetlbfs = " ${SECURITY_NOPIE_CFLAGS}"
SECURITY_CFLAGS_pn-libid3tag = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-libmemcached = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-libnewt = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-libnewt-python = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-libpcap = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-libpcre = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-libproxy = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-libsigc++-2.0 = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-libvirt = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-lmsensors = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-ltp = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-lttng-tools_arm = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-lttng-ust = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-lvm2 = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-lxc = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-makedumpfile = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-mariadb = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-mesa-gl = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-mesa = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-mdadm_mips64 = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-mysql-python = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-ncurses = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-net-tools = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-nagios-core = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-openais = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-openhpi = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-openjdk-7 = "${SECURITY_NO_FORTIFY_CFLAGS}"
SECURITY_CFLAGS_pn-openjdk-8 = "${SECURITY_NO_FORTIFY_CFLAGS}"
SECURITY_CFLAGS_pn-openldap = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-openl2tp = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-opensaf = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-opensp = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-openssl = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-pangomm = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-pciutils = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-ppp = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-protobuf = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-pseudo = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-pulseaudio = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-poppler = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-python-cffi = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-python-cython = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-python-imaging = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-python-ldap = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-python-lxml = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-python-m2crypto = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-python-numpy = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-python-pycrypto = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-python-pycurl = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-python-pygpgme = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-python = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-python-smartpm = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-python-snimpy = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-python-twisted = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-relayd = "${SECURITY_NO_FORTIFY_CFLAGS}"
SECURITY_CFLAGS_pn-rng-tools = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-rrdtool = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-sed = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-setools = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-snappy = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-squid = ""
SECURITY_CFLAGS_pn-tbb = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-tboot = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-tcl = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-tiff = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-tpm2.0-tss = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-tsocks = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-vdso-test = ""
SECURITY_CFLAGS_pn-webkit-gtk = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-wireshark = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-xerces-c = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-zeromq = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-zlib = "${SECURITY_NO_PIE_CFLAGS}"

# Analysis tools needing relaxed security cflags
SECURITY_CFLAGS_pn-libunwind = "${SECURITY_NO_FORTIFY_CFLAGS}"
SECURITY_CFLAGS_pn-pth = "${SECURITY_NO_FORTIFY_CFLAGS}"
SECURITY_CFLAGS_pn-wdbagent-ptrace = "${SECURITY_NO_PIE_CFLAGS}"
SECURITY_CFLAGS_pn-wr-opagent = "${SECURITY_NO_PIE_CFLAGS}"

TARGET_CFLAGS_remove_pn-lib32-directfb := "-fstack-protector-all -pie -fpie -D_FORTIFY_SOURCE=2"
TARGET_CFLAGS_remove_pn-directfb := "-fstack-protector-all -pie -fpie -D_FORTIFY_SOURCE=2"

SECURITY_LDFLAGS_remove_pn-dpdk = "-fstack-protector-strong"
SECURITY_LDFLAGS_remove_pn-libsign = "-fstack-protector-strong"

SECURITY_LDFLAGS_pn-netmap-modules_mips64 = " -z,relro,-z,now"
SECURITY_LDFLAGS_pn-cryptfs-tpm2 = ""

# Recipes which fail to compile when elevating -Wformat-security to an error
SECURITY_STRINGFORMAT_pn-boost = "${@bb.utils.contains('DISTRO_FEATURES', 'ptest', '', '-Wformat -Wformat-security -Werror=format-security', d)}"
SECURITY_STRINGFORMAT_pn-dnrd = ""
SECURITY_STRINGFORMAT_pn-iperf = ""
SECURITY_STRINGFORMAT_pn-libunique = ""
SECURITY_STRINGFORMAT_pn-linux-atm = ""
SECURITY_STRINGFORMAT_pn-makedumpfile = ""
SECURITY_STRINGFORMAT_pn-mipv6-daemon-umip = ""
SECURITY_STRINGFORMAT_pn-mysql-connector-odbc = ""
SECURITY_STRINGFORMAT_pn-netkit-rpc = ""
SECURITY_STRINGFORMAT_pn-netkit-telnet = ""
SECURITY_STRINGFORMAT_pn-ocfs2-tools = ""
SECURITY_STRINGFORMAT_pn-rdate = ""
SECURITY_STRINGFORMAT_pn-selinux-autorelabel = ""
SECURITY_STRINGFORMAT_pn-setools = ""
SECURITY_STRINGFORMAT_pn-xfce4-notes-plugin = ""
